# 25. å®¢æˆ·ç«¯å­˜å‚¨

## cookie

### é™åˆ¶

cookie åœ¨æµè§ˆå™¨ä¸­çš„é™åˆ¶å¦‚ä¸‹ï¼š

- `ä¸è¶…è¿‡ 300 ä¸ª cookie`
- `æ¯ä¸ªcookieä¸è¶…è¿‡4096å­—èŠ‚`
  - ä¸åŒæµè§ˆå™¨ä¼šæœ‰ä¸Šä¸‹ä¸€ä¸ªå­—èŠ‚çš„è¯¯å·®ï¼Œå› æ­¤ä¸è¶…è¿‡ 4095 å­—èŠ‚æ˜¯æ¯”è¾ƒä¿é™©çš„
- `æ¯ä¸ªåŸŸcookieæ€»æ•°æœ‰é™åˆ¶`
  - IE & Edge é™åˆ¶ 50 ä¸ª
  - Firefox é™åˆ¶ 150 ä¸ª
  - Opera é™åˆ¶ 180 ä¸ª
  - Safari & Chrome å¯¹æ¯ä¸ªåŸŸçš„ cookie æ•°æ²¡æœ‰ç¡¬æ€§é™åˆ¶
- `æ¯ä¸ªåŸŸä¸è¶…è¿‡81920ä¸ªå­—èŠ‚` ğŸ¤”ï¸â“

cookie æ€»æ•°è¶…è¿‡å•ä¸ªåŸŸçš„é™åˆ¶åï¼Œæµè§ˆå™¨ä¼šåˆ é™¤ä¹‹å‰çš„ cookieã€‚`IE & Operaä¼šæŒ‰æœ€è¿‘æœ€å°‘ä½¿ï¼ˆLRU, Least Recently Usedï¼‰ç”¨åŸåˆ™åˆ é™¤ï¼ŒFirefoxä¼šéšæœºåˆ é™¤ä¹‹å‰çš„cookieã€‚`

### cookie çš„æ„æˆ

- `åç§°`ï¼šcookie çš„å”¯ä¸€æ ‡è¯†ï¼Œå®ƒæ˜¯`ä¸åŒºåˆ†å¤§å°å†™`çš„ï¼Œä½†æ˜¯ä¸ºé¿å…æ„å¤–ï¼Œ`å®é™…ä¸­å½“ä½œåŒºåˆ«å¤§å°å†™å¯¹å¾…æ¯”è¾ƒä¿é™©`ã€‚`cookieåå¿…é¡»ç»è¿‡URLç¼–ç `ã€‚
- `å€¼`ï¼šå­˜å‚¨åœ¨ cookie é‡Œçš„å­—ç¬¦ä¸²å€¼ã€‚è¿™ä¸ªå€¼`å¿…é¡»ç»è¿‡ URL ç¼–ç `ã€‚
- `åŸŸ`ï¼šcookie æœ‰æ•ˆçš„åŸŸï¼Œå‘é€åˆ°è¿™ä¸ªåŸŸçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šåŒ…å«å¯¹åº”çš„ cookieã€‚
  > ä»¥ main.comã€a.main.com å’Œ b.main.com ä¸ºä¾‹ï¼Œä»¥ä¸‹çš„ç»“æœåœ¨`Chrome`ä¸­æµ‹è¯•å¾—å‡ºï¼š
  >
  > 1ï¼‰åœ¨ a.main.com ä¸­è®¾ç½® cookie a=1ï¼Œ`ä¸æ˜ç¡®è®¾å®šæœ‰æ•ˆåŸŸ`ï¼Œmain.com å’Œ b.main.com éƒ½çœ‹ä¸åˆ°è¯¥ cookie è®°å½•ã€‚`è¿™æ—¶å¯ä»¥çœ‹åˆ°æµè§ˆå™¨å°†æœ‰æ•ˆåŸŸè®¾ä¸ºäº†a.main.com`ã€‚
  >
  > 2ï¼‰åœ¨ a.main.com ä¸­è®¾ç½® cookie a=1ï¼Œ`è®¾å®šæœ‰æ•ˆåŸŸä¸ºmain.comï¼ˆä¸è®¾ä¸º.main.comçš„æ•ˆæœä¸€æ ·ï¼‰`ï¼Œmain.com å’Œ b.main.com éƒ½å¯ä»¥çœ‹åˆ°è¯¥ cookie è®°å½•ã€‚`è¿™æ—¶å¯ä»¥çœ‹åˆ°æµè§ˆå™¨å°†æœ‰æ•ˆåŸŸè®¾ä¸ºäº†.main.com`ï¼Œæ„å‘³ç€è¯¥ cookie å¯¹`main.com`åŠå…¶å­åŸŸéƒ½æœ‰æ•ˆã€‚
  >
  > å¢™è£‚æ¨èåœ¨ [ğŸ‘‰ Cookies æµ‹è¯•è„šæœ¬ ğŸ‘ˆ](https://scripts.cmbuckley.co.uk/cookies.php) ä¸­è‡ªå·±å®é™…ä½“éªŒä¸€ç•ª
- `è·¯å¾„`ï¼šè¯·æ±‚ URL ä¸­åŒ…å«è¿™ä¸ªè·¯å¾„æ‰ä¼šæŠŠ cookie å‘é€åˆ°æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŒ‡å®š cookie åªèƒ½ç”±
  http://www.main.com/books/ è®¿é—®ï¼Œå› æ­¤è®¿é—® http://www.main.com/ ä¸‹çš„é¡µé¢å°±ä¸ä¼šå‘é€ cookieï¼Œå³
  ä½¿è¯·æ±‚çš„æ˜¯åŒä¸€ä¸ªåŸŸã€‚
- `è¿‡æœŸæ—¶é—´`ï¼šè¡¨ç¤ºä½•æ—¶åˆ é™¤ cookie çš„æ—¶é—´æˆ³ï¼ŒGMT æ ¼å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¼šè¯ç»“æŸåä¼šåˆ é™¤æ‰€æœ‰ cookieã€‚
- `å®‰å…¨æ ‡å¿—`ï¼šè®¾ç½®ä¹‹åï¼Œåªåœ¨ä½¿ç”¨ SSL å®‰å…¨è¿æ¥çš„æƒ…å†µä¸‹æ‰ä¼šæŠŠ cookie å‘é€åˆ°æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼Œè¯·
  æ±‚ https://www.main.com ä¼šå‘é€ cookieï¼Œè€Œè¯·æ±‚ http://www.main.com åˆ™ä¸ä¼šã€‚

```js
// Set-Cookie å¤´éƒ¨
HTTP/1.1 200 OK
Content-type: text/html
Set-Cookie: name=value; expires=Mon, 22-Jan-07 07:10:24 GMT; domain=.wrox.com; path=/; secure
Other-header: other-header-value
```

## Web Storage

`Web Storage` ç¬¬ 2 ç‰ˆè§„èŒƒå®šä¹‰äº†ä¸¤ä¸ªå¯¹è±¡ï¼š`localStorage` å’Œ `sessionStorage`ã€‚

### Storage ç±»å‹

`Storage`ç±»å‹ç”¨äºä¿å­˜å/å€¼å¯¹æ•°æ®ï¼Œ`Storage`çš„å®ä¾‹ä¸å…¶ä»–å¯¹è±¡ä¸€æ ·ï¼Œä½†å¢åŠ äº†ä»¥ä¸‹æ–¹æ³•ï¼š

- `clear()`ï¼šåˆ é™¤æ‰€æœ‰å€¼ï¼›ä¸åœ¨ Firefox ä¸­å®ç°ã€‚
- `getItem(name)`ï¼šå–å¾—ç»™å®š name çš„å€¼ã€‚
- `key(index)`ï¼šå–å¾—ç»™å®šæ•°å€¼ä½ç½®çš„åç§°ã€‚
- `removeItem(name)`ï¼šåˆ é™¤ç»™å®š name çš„å/å€¼å¯¹ã€‚
- `setItem(name, value)`ï¼šè®¾ç½®ç»™å®š name çš„å€¼ã€‚

æ¯
ä¸ªæ•°æ®é¡¹éƒ½ä½œä¸ºå±æ€§å­˜å‚¨åœ¨`Storage`å¯¹è±¡ä¸Šï¼Œ`äºæ˜¯å¯ä»¥ä½¿ç”¨ç”¨ç‚¹æˆ–æ–¹æ‹¬å·æ“ä½œç¬¦è®¿é—®è¿™äº›å±æ€§ï¼Œä¹Ÿå¯é€šè¿‡ length å±æ€§å¯ä»¥ç¡®å®š Storage å¯¹è±¡ä¸­ä¿å­˜äº†å¤šå°‘å/å€¼å¯¹`ã€‚

### sessionStorage

`sessionStorage` å¯¹è±¡ä¸»è¦ç”¨äºå­˜å‚¨åªåœ¨ä¼šè¯æœŸé—´æœ‰æ•ˆçš„å°å—æ•°æ®ï¼Œè¿™è·Ÿæµè§ˆå™¨å…³é—­æ—¶ä¼šæ¶ˆå¤±çš„ä¼šè¯ cookie ç±»ä¼¼ã€‚

`æ‰€æœ‰ç°ä»£æµè§ˆå™¨åœ¨å®ç°å­˜å‚¨å†™å…¥æ—¶éƒ½ä½¿ç”¨äº†åŒæ­¥é˜»å¡æ–¹å¼ï¼Œå› æ­¤æ•°æ®ä¼šè¢«ç«‹å³æäº¤åˆ°å­˜å‚¨ã€‚å…·ä½“API çš„å®ç°å¯èƒ½ä¸ä¼šç«‹å³æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼ˆè€Œæ˜¯ä½¿ç”¨æŸç§ä¸åŒçš„ç‰©ç†å­˜å‚¨ï¼‰ï¼Œä½†è¿™ä¸ªåŒºåˆ«åœ¨ JavaScript å±‚é¢æ˜¯ä¸å¯è§çš„ã€‚é€šè¿‡ Web Storage å†™å…¥çš„ä»»ä½•æ•°æ®éƒ½å¯ä»¥ç«‹å³è¢«è¯»å–ã€‚`

### localStorage

åœ¨ HTML5 è§„èŒƒé‡Œï¼Œ `localStorage` å¯¹è±¡å–ä»£äº† `globalStorage`ï¼Œæ¥è‡ªåŒä¸€ä¸ªåŸŸï¼ˆå­åŸŸä¸è¡Œï¼‰çš„é¡µé¢æ‰èƒ½è®¿é—®åŒä¸€ä¸ª`localStorage`å¯¹è±¡ï¼šåŸŸåã€åè®®ã€ç«¯å£éƒ½ç›¸åŒã€‚

`å­˜å‚¨åœ¨ localStorage ä¸­çš„æ•°æ®ä¼šä¿ç•™åˆ°é€šè¿‡ JavaScript åˆ é™¤æˆ–è€…ç”¨æˆ·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚`

### å­˜å‚¨äº‹ä»¶ä¸é™åˆ¶

å¯¹äº `sessionStorage` å’Œ `localStorage` ä¸Šçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šè§¦å‘ `storage` äº‹ä»¶ï¼Œä½† `storage` äº‹
ä»¶ä¸ä¼šåŒºåˆ†è¿™ä¸¤è€…ã€‚è¿™ä¸ªäº‹ä»¶å¯¹è±¡æœ‰å¦‚ä¸‹å››ä¸ªå±æ€§ï¼š

- domainï¼šå­˜å‚¨å˜åŒ–å¯¹åº”çš„åŸŸã€‚
- keyï¼šè¢«è®¾ç½®æˆ–åˆ é™¤çš„é”®ã€‚
- newValueï¼šé”®è¢«è®¾ç½®çš„æ–°å€¼ï¼Œè‹¥é”®è¢«åˆ é™¤åˆ™ä¸º nullã€‚
- oldValueï¼šé”®å˜åŒ–ä¹‹å‰çš„å€¼ã€‚

```js
window.addEventListener('storage', (event) =>
  alert('Storage changed for ${event.domain}')
);
```

`ä¸åŒæµè§ˆå™¨ç»™ localStorage å’Œ sessionStorage è®¾ç½®äº†ä¸åŒçš„ç©ºé—´é™åˆ¶ï¼Œä½†å¤§å¤šæ•°ä¼šé™åˆ¶ä¸ºæ¯ä¸ªæº5MBã€‚`

## IndexedDB21394

`IndexedDB` ç›¸æ¯” `cookie` å’Œ `WebStorage` çš„ä¼˜åŠ¿æ˜¯å…¶èƒ½å­˜å‚¨å¤§é‡æ•°æ®ï¼Œé€šä¿—åœ°è¯´ï¼Œ`IndexedDB` å°±æ˜¯æµè§ˆå™¨æä¾›çš„æœ¬åœ°æ•°æ®åº“ï¼Œå®ƒå¯ä»¥è¢«ç½‘é¡µè„šæœ¬åˆ›å»ºå’Œæ“ä½œã€‚ `IndexedDB` å…è®¸å‚¨å­˜å¤§é‡æ•°æ®ï¼Œæä¾›æŸ¥æ‰¾æ¥å£ï¼Œè¿˜èƒ½å»ºç«‹ç´¢å¼•ã€‚å°±æ•°æ®åº“ç±»å‹è€Œè¨€ï¼Œ`IndexedDB` ä¸å±äºå…³ç³»å‹æ•°æ®åº“ï¼ˆä¸æ”¯æŒ `SQL` æŸ¥è¯¢è¯­å¥ï¼‰ï¼Œæ›´æ¥è¿‘ `NoSQL` æ•°æ®åº“ã€‚`IndexedDB éµå¾ªåŒæºç­–ç•¥`ã€‚

> å­¦ä¹  IndexedDB æ›´åƒæ˜¯åœ¨å­¦ä¹ ä¸€é—¨æ•°æ®åº“çš„æ“ä½œï¼Œçœ‹äº†ä¸€éï¼Œæš‚æœªå†™å…·ä½“çš„ä½¿ç”¨æ€»ç»“ï¼Œä¹‹åå¯ä»¥å‚è€ƒï¼š[æµè§ˆå™¨æ•°æ®åº“ IndexedDB å…¥é—¨æ•™ç¨‹ é˜®ä¸€å³°](http://www.ruanyifeng.com/blog/2018/07/indexeddb.html)ã€[HTML5 indexedDB å‰ç«¯æœ¬åœ°å­˜å‚¨æ•°æ®åº“å®ä¾‹æ•™ç¨‹ å¼ é‘«æ—­](https://www.zhangxinxu.com/wordpress/2017/07/html5-indexeddb-js-example/)å’Œ[MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API/Basic_Concepts_Behind_IndexedDB)
